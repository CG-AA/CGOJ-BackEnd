<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CGOJ-BackEnd: src/CROW_ROUTEs/problems.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">CGOJ-BackEnd
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_67e81576e3c341b6c115a1fe285e2d70.html">CROW_ROUTEs</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">problems.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Implementation of the problems route.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="problems_8hpp_source.html">problems.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="jwt_8hpp_source.html">../Programs/jwt.hpp</a>&quot;</code><br />
<code>#include &lt;jwt-cpp/jwt.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for problems.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="problems_8cpp__incl.png" border="0" usemap="#asrc_2CROW__ROUTEs_2problems_8cpp" alt=""/></div>
<map name="asrc_2CROW__ROUTEs_2problems_8cpp" id="asrc_2CROW__ROUTEs_2problems_8cpp">
<area shape="rect" title="Implementation of the problems route." alt="" coords="984,5,1221,31"/>
<area shape="rect" href="problems_8hpp.html" title="Declaration of the problems route." alt="" coords="841,79,951,104"/>
<area shape="poly" title=" " alt="" coords="1070,33,943,77,942,72,1069,28"/>
<area shape="rect" href="jwt_8hpp.html" title="Header file for the JSON Web Token (JWT) functions." alt="" coords="1029,79,1177,104"/>
<area shape="poly" title=" " alt="" coords="1105,31,1105,65,1100,65,1100,31"/>
<area shape="rect" title=" " alt="" coords="1255,152,1361,177"/>
<area shape="poly" title=" " alt="" coords="1122,29,1191,76,1282,141,1279,146,1188,81,1118,33"/>
<area shape="rect" title=" " alt="" coords="783,152,847,177"/>
<area shape="poly" title=" " alt="" coords="885,106,840,145,836,141,881,102"/>
<area shape="rect" title=" " alt="" coords="53,152,237,177"/>
<area shape="poly" title=" " alt="" coords="841,100,252,154,251,149,840,95"/>
<area shape="rect" title=" " alt="" coords="1001,152,1148,177"/>
<area shape="poly" title=" " alt="" coords="926,102,1034,144,1032,149,924,107"/>
<area shape="rect" href="api_8hpp.html" title="Header file for the APIs class." alt="" coords="871,152,977,177"/>
<area shape="poly" title=" " alt="" coords="903,103,917,138,912,140,898,105"/>
<area shape="rect" href="lrucache_8hpp.html" title="Simple LRU (Least Recently Used) cache implementation." alt="" coords="261,152,429,177"/>
<area shape="poly" title=" " alt="" coords="841,102,443,153,443,148,840,97"/>
<area shape="rect" title=" " alt="" coords="1631,225,1750,251"/>
<area shape="poly" title=" " alt="" coords="978,173,990,175,1164,192,1302,199,1440,206,1618,223,1617,228,1440,212,1302,205,1164,197,989,180,977,178"/>
<area shape="rect" title=" " alt="" coords="516,225,668,251"/>
<area shape="poly" title=" " alt="" coords="871,180,660,225,658,220,870,175"/>
<area shape="rect" title=" " alt="" coords="693,225,822,251"/>
<area shape="poly" title=" " alt="" coords="898,180,798,222,796,217,896,175"/>
<area shape="rect" title=" " alt="" coords="846,225,1002,251"/>
<area shape="poly" title=" " alt="" coords="927,178,927,212,921,212,921,178"/>
<area shape="rect" title=" " alt="" coords="1027,225,1176,251"/>
<area shape="poly" title=" " alt="" coords="953,175,1061,218,1059,223,952,180"/>
<area shape="rect" title=" " alt="" coords="1201,225,1359,251"/>
<area shape="poly" title=" " alt="" coords="978,174,1210,220,1209,225,977,179"/>
<area shape="rect" title=" " alt="" coords="1384,225,1608,251"/>
<area shape="poly" title=" " alt="" coords="978,173,990,175,1190,201,1370,221,1370,227,1189,206,989,180,977,178"/>
<area shape="rect" title=" " alt="" coords="94,225,218,251"/>
<area shape="poly" title=" " alt="" coords="316,180,201,223,199,218,314,175"/>
<area shape="rect" title=" " alt="" coords="243,225,285,251"/>
<area shape="poly" title=" " alt="" coords="334,179,289,218,286,214,331,175"/>
<area shape="rect" title=" " alt="" coords="310,225,381,251"/>
<area shape="poly" title=" " alt="" coords="348,178,348,212,343,212,343,178"/>
<area shape="rect" title=" " alt="" coords="405,225,491,251"/>
<area shape="poly" title=" " alt="" coords="363,175,421,215,418,219,360,180"/>
<area shape="rect" title=" " alt="" coords="5,225,69,251"/>
<area shape="poly" title=" " alt="" coords="294,180,83,228,83,228,82,223,82,223,293,175"/>
<area shape="poly" title=" " alt="" coords="1101,105,1087,140,1082,138,1096,103"/>
<area shape="poly" title=" " alt="" coords="1075,107,967,149,965,144,1073,102"/>
<area shape="rect" title=" " alt="" coords="1172,152,1231,177"/>
<area shape="poly" title=" " alt="" coords="1120,102,1176,142,1173,146,1117,106"/>
<area shape="poly" title=" " alt="" coords="1137,101,1263,145,1261,150,1135,107"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a3b34d447ce222e94e1ebde7107cde756" id="r_a3b34d447ce222e94e1ebde7107cde756"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3b34d447ce222e94e1ebde7107cde756">ROUTE_problems</a> (crow::App&lt; crow::CORSHandler &gt; &amp;<a class="el" href="main_8cpp.html#afce6e82e7f4ddd54d9bbf8894ccc85ab">app</a>, nlohmann::json &amp;<a class="el" href="main_8cpp.html#a226e5c87ec0382336e0be64e07be3723">settings</a>, std::string <a class="el" href="main_8cpp.html#a57430442c3d9a40c976af8e13ab34029">IP</a>, std::unique_ptr&lt; <a class="el" href="classAPIs.html">APIs</a> &gt; &amp;API, <a class="el" href="classcache_1_1lru__cache.html">cache::lru_cache</a>&lt; int8_t, nlohmann::json &gt; &amp;<a class="el" href="main_8cpp.html#a70942e25e0034f5fb506d5843198ade3">problems_everyone_cache</a>, std::atomic&lt; bool &gt; &amp;<a class="el" href="main_8cpp.html#afa2dc980a43447849a3f06722980a126">problems_everyone_cache_hit</a>)</td></tr>
<tr class="memdesc:a3b34d447ce222e94e1ebde7107cde756"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configures a route for accessing a list of problems.  <br /></td></tr>
<tr class="separator:a3b34d447ce222e94e1ebde7107cde756"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implementation of the problems route. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a3b34d447ce222e94e1ebde7107cde756" name="a3b34d447ce222e94e1ebde7107cde756"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3b34d447ce222e94e1ebde7107cde756">&#9670;&#160;</a></span>ROUTE_problems()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ROUTE_problems </td>
          <td>(</td>
          <td class="paramtype">crow::App&lt; crow::CORSHandler &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>app</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">nlohmann::json &amp;</td>          <td class="paramname"><span class="paramname"><em>settings</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string</td>          <td class="paramname"><span class="paramname"><em>IP</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::unique_ptr&lt; <a class="el" href="classAPIs.html">APIs</a> &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>API</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classcache_1_1lru__cache.html">cache::lru_cache</a>&lt; int8_t, nlohmann::json &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>problems_everyone_cache</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::atomic&lt; bool &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>problems_everyone_cache_hit</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Configures a route for accessing a list of problems. </p>
<p>This function sets up a route "/problems" on the provided Crow application instance. It handles GET requests to fetch a list of problems, supporting pagination and role-based filtering. The function performs JWT verification, role extraction, and conditionally queries the database or cache based on the roles and pagination parameters.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">app</td><td>Reference to the Crow application instance configured with CORSHandler middleware. </td></tr>
    <tr><td class="paramname">settings</td><td>JSON object containing configuration settings, used for JWT verification and role-based access control. </td></tr>
    <tr><td class="paramname">IP</td><td>String representing the IP address for additional security checks in JWT verification. </td></tr>
    <tr><td class="paramname">API</td><td>Unique pointer to an <a class="el" href="classAPIs.html" title="A class that provides an interface for interacting with a MySQL database.">APIs</a> instance, used for database operations. </td></tr>
    <tr><td class="paramname">problems_everyone_cache</td><td>Reference to an LRU cache instance for caching problems accessible to everyone. </td></tr>
    <tr><td class="paramname">problems_everyone_cache_hit</td><td>Atomic boolean flag indicating whether the cache for problems accessible to everyone has been populated.</td></tr>
  </table>
  </dd>
</dl>
<p>The function begins by verifying the JWT from the request header and extracting roles. It then processes query parameters for pagination. Based on the roles and pagination, it either queries the database for problems or retrieves them from the cache. The function supports a special case where problems accessible to everyone are cached to improve performance. It returns a JSON response with the list of problems or an error message if no problems are found. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
